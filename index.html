<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å</title>
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- –ú–æ–∂–Ω–∞ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –≤–∞—à –≤–ª–∞—Å–Ω–∏–π CSS —Ñ–∞–π–ª —Ç—É—Ç -->
    <!-- <link rel="stylesheet" href="styles.css"> -->

    <style>
        /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ */
        .question-step {
            display: none;
        }

        .active-step {
            display: block;
        }

        /* –ù–æ–≤–∏–π —Å—Ç–∏–ª—å –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö */
        .current-data-preview {
            background-color: #f8f9fa;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .current-data-preview h6 {
            color: #0d6efd;
            margin-bottom: 10px;
        }
    </style>

</head>

<body class="bg-light">

    <div class="container py-5">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="row justify-content-center mb-4">
            <div class="col-md-8 text-center">
                <h1 class="display-6">–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å</h1>
                <p class="lead">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω –≤–∞—à–æ—ó –ø–æ—ó–∑–¥–∫–∏</p>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—ñ–π) -->
        <div class="row justify-content-center mb-4">
            <div class="col-md-8">
                <div id="summary-container" class="card">
                    <div class="card-header">
                        –ó–≤–µ–¥–µ–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
                    </div>
                    <div id="trip-summary" class="card-body">
                        <!-- –¢—É—Ç –¥–∏–Ω–∞–º—ñ—á–Ω–æ –±—É–¥–µ –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–∂–µ–Ω —Å–µ–≥–º–µ–Ω—Ç -->
                        <p class="text-muted mb-0">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–æ—Ä–º–∏ –∑ –ø–∏—Ç–∞–Ω–Ω—è–º–∏ -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-body p-4">

                        <!-- –ü–æ—á–∞—Ç–æ–∫ —Ñ–æ—Ä–º–∏ -->
                        <form id="trip-form">

                            <!-- –ö—Ä–æ–∫ 1: –ú—ñ—Å—Ç–æ –ø–æ—á–∞—Ç–∫—É -->
                            <div id="step-1" class="question-step active-step">
                                <h5 class="card-title mb-4">1. –ú—ñ—Å—Ç–æ –ø–æ—á–∞—Ç–∫—É –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="departure-city" class="form-label">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ:</label>
                                    <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥—É –º—ñ—Å—Ç–∞ –∑ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è–º -->
                                    <input type="text" class="form-control" id="departure-city"
                                        placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                                    <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (–±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π —á–µ—Ä–µ–∑ JS) -->
                                    <div id="city-suggestions" class="list-group mt-2" style="display: none;"></div>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-primary" onclick="processStep1()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(2)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ö—Ä–æ–∫ 2: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –≤–∏—ó–∑–¥—É -->
                            <div id="step-2" class="question-step">
                                <h5 class="card-title mb-4">2. –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –≤–∏—ó–∑–¥—É</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="departure-date" class="form-label">–î–∞—Ç–∞:</label>
                                        <input type="date" class="form-control" id="departure-date">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="departure-time" class="form-label">–ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å:</label>
                                        <select class="form-select" id="departure-time">
                                            <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                            <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-secondary me-2"
                                        onclick="showStep(1)">–ù–∞–∑–∞–¥</button>
                                    <button type="button" class="btn btn-primary" onclick="processStep2()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(3)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ö—Ä–æ–∫ 3: –¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É -->
                            <div id="step-3" class="question-step">
                                <h5 class="card-title mb-4">3. –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="d-grid gap-2 d-md-block mb-4">
                                    <!-- –ì—Ä—É–ø–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤–∏–±–æ—Ä—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É -->
                                    <button type="button" class="btn btn-outline-primary transport-btn"
                                        data-transport="train">–ó–∞–ª—ñ–∑–Ω–∏—Ü—è</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn"
                                        data-transport="company_car">–°–ª—É–∂–±–æ–≤–µ –∞–≤—Ç–æ</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn"
                                        data-transport="bus">–ê–≤—Ç–æ–±—É—Å</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn"
                                        data-transport="personal_car">–û—Å–æ–±–∏—Å—Ç–µ –∞–≤—Ç–æ</button>
                                </div>
                                <input type="hidden" id="selected-transport">
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-secondary me-2"
                                        onclick="showStep(2)">–ù–∞–∑–∞–¥</button>
                                    <button type="button" class="btn btn-primary" onclick="processStep3()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(4)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ú—ñ—Å—Ü–µ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤ (4, 5, 6...) -->
                            <!-- –ö—Ä–æ–∫ 4: –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è -->
                            <div id="step-4" class="question-step">
                                <h5 class="card-title mb-4">4. –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="arrival-city" class="form-label">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ:</label>
                                    <input type="text" class="form-control" id="arrival-city"
                                        placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                                    <div id="arrival-city-suggestions" class="list-group mt-2" style="display: none;">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(3)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep4()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 5: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è -->
                            <div id="step-5" class="question-step">
                                <h5 class="card-title mb-4">5. –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="arrival-date" class="form-label">–î–∞—Ç–∞:</label>
                                        <input type="date" class="form-control" id="arrival-date">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="arrival-time" class="form-label">–ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å:</label>
                                        <select class="form-select" id="arrival-time">
                                            <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                            <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                        </select>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(4)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep5()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 6: –ù–æ—á—ñ–≤–ª—è -->
                            <div id="step-6" class="question-step">
                                <h5 class="card-title mb-4">6. –ß–∏ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∞ –Ω–æ—á—ñ–≤–ª—è?</h5>
                                <!-- –ü—Ä–µ–≤—å—é –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—î) -->
                                <div id="step-${stepNumber}-preview" class="current-data-preview"
                                    style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-${stepNumber}-preview-content"></div>
                                </div>
                                <div class="mb-4">
                                    <button type="button" class="btn btn-outline-primary me-2 overnight-btn"
                                        data-overnight="true">–¢–∞–∫</button>
                                    <button type="button" class="btn btn-outline-primary overnight-btn"
                                        data-overnight="false">–ù—ñ</button>
                                    <input type="hidden" id="overnight-stay">
                                </div>
                                <!-- –ë–ª–æ–∫ –¥–ª—è –≥–æ—Ç–µ–ª—é (–∑'—è–≤–∏—Ç—å—Å—è –ª–∏—à–µ —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–¢–∞–∫") -->
                                <div id="hotel-selection-block" style="display: none;" class="mb-3">
                                    <label for="hotel-select" class="form-label">–û–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å:</label>
                                    <select class="form-select" id="hotel-select">
                                        <option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤...</option>
                                    </select>
                                </div>
                                <!-- –ë–ª–æ–∫ –¥–ª—è —á–∞—Å—É –≤–∏—ó–∑–¥—É (–∑'—è–≤–∏—Ç—å—Å—è –ª–∏—à–µ —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–ù—ñ") -->
                                <div id="departure-time-block" style="display: none;" class="mb-3">
                                    <label for="next-departure-time" class="form-label">–ß–∞—Å –≤–∏—ó–∑–¥—É:</label>
                                    <select class="form-select" id="next-departure-time">
                                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                        <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                    </select>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(5)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep6()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 7: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è/–î–æ–¥–∞—Ç–∏ —â–µ –º—ñ—Å—Ç–æ -->
                            <div id="step-7" class="question-step">
                                <h5 class="card-title mb-4">–°–µ–≥–º–µ–Ω—Ç –ø–æ—ó–∑–¥–∫–∏ –¥–æ–¥–∞–Ω–æ!</h5>
                                <p class="mb-4">–í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —â–µ –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç (–º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è —Å—Ç–∞–Ω–µ –º—ñ—Å—Ç–æ–º
                                    –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è) –∞–±–æ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è.</p>
                                <button type="button" class="btn btn-outline-secondary me-2"
                                    onclick="addAnotherLeg()">–î–æ–¥–∞—Ç–∏ —â–µ –º—ñ—Å—Ç–æ</button>
                                <button type="button" class="btn btn-success" id="finish-btn"
                                    onclick="finishTrip()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</button>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏" –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –∫—Ä–æ—Ü—ñ -->
                            <!-- <button type="button" id="finish-btn" class="btn btn-success">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button> -->

                        </form>
                        <!-- –ö—ñ–Ω–µ—Ü—å —Ñ–æ—Ä–º–∏ -->

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ Bootstrap JS —Ç–∞ Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –Ω–∞—à –≤–ª–∞—Å–Ω–∏–π JS —Ñ–∞–π–ª -->
    <!-- <script src="script.js"></script> -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —Ñ–æ—Ä–º–∏
        const tripData = {
            legs: [] // –ú–∞—Å–∏–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –ø–æ—ó–∑–¥–∫–∏
        };
        let currentStep = 1;
        let currentLeg = {}; // –ü–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç, —è–∫–∏–π –∑–∞–ø–æ–≤–Ω—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

        // ===== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –†–û–ë–û–¢–ò –ó –§–û–†–ú–û–Æ =====
        function showStep(stepNumber) {
            document.querySelector(`.question-step.active-step`).classList.remove('active-step');
            document.getElementById(`step-${stepNumber}`).classList.add('active-step');
            currentStep = stepNumber;
        }

        // –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ <select> –æ–ø—Ü—ñ—è–º–∏ —á–∞—Å—É
        function populateSelectWithTime(selectId) {
            const timeSelect = document.getElementById(selectId);
            if (!timeSelect) return; // –Ø–∫—â–æ —Ç–∞–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ–º–∞—î, –≤–∏—Ö–æ–¥–∏–º–æ
            timeSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';

            for (let hours = 0; hours < 24; hours++) {
                for (let minutes = 0; minutes < 60; minutes += 30) {
                    const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                    const option = new Option(timeString, timeString);
                    timeSelect.appendChild(option);
                }
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É (–∫—Ä–æ–∫ 3)
        function setupTransportButtons() {
            const transportButtons = document.querySelectorAll('.transport-btn');
            transportButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // –í–∏–¥–∞–ª—è—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å —É –≤—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
                    transportButtons.forEach(btn => btn.classList.remove('active'));
                    // –î–æ–¥–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –¥–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–æ—ó –∫–Ω–æ–ø–∫–∏
                    this.classList.add('active');
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –ø—Ä–∏—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ
                    document.getElementById('selected-transport').value = this.dataset.transport;
                });
            });
        }

        // ===== –ö–†–û–ö 4: –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è =====
        function processStep4() {
            const cityInput = document.getElementById('arrival-city');
            const cityName = cityInput.value.trim();

            if (cityName === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è.');
                return;
            }

            currentLeg.arrivalCity = cityName;
            cityInput.value = ''; // –û—á–∏—â–∞—î–º–æ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            showStep(5);
        }

        // ===== –ö–†–û–ö 5: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è =====
        function processStep5() {
            const departureDateInput = document.getElementById('departure-date');
            const arrivalDateInput = document.getElementById('arrival-date');
            const timeSelect = document.getElementById('arrival-time');

            if (arrivalDateInput.value === '' || timeSelect.value === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è.');
                return;
            }

            // –ü–ï–†–ï–í–Ü–†–ö–ê: –¥–∞—Ç–∞ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É
            if (arrivalDateInput.value < departureDateInput.value) {
                alert('–î–∞—Ç–∞ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É!');
                return;
            }

            // –î–û–î–ê–¢–ö–û–í–ê –ü–ï–†–ï–í–Ü–†–ö–ê: —è–∫—â–æ –¥–∞—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å
            if (arrivalDateInput.value === departureDateInput.value) {
                const departureTime = document.getElementById('departure-time').value;
                // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —á–∞—Å –≤ —Ö–≤–∏–ª–∏–Ω–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                const [depHours, depMinutes] = departureTime.split(':').map(Number);
                const [arrHours, arrMinutes] = timeSelect.value.split(':').map(Number);
                
                const depTotalMinutes = depHours * 60 + depMinutes;
                const arrTotalMinutes = arrHours * 60 + arrMinutes;
                
                if (arrTotalMinutes <= depTotalMinutes) {
                    alert('–ß–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —á–∞—Å—É –≤–∏—ó–∑–¥—É!');
                    return;
                }
            }

            currentLeg.arrivalDate = arrivalDateInput.value;
            currentLeg.arrivalTime = timeSelect.value;

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è
            arrivalDateInput.value = '';
            timeSelect.selectedIndex = 0;

            showStep(6);
        }

        // ===== –ö–†–û–ö 6: –ù–æ—á—ñ–≤–ª—è =====
        // –°–ø–æ—á–∞—Ç–∫—É –Ω–∞–ª–∞—à—Ç—É—î–º–æ –∫–Ω–æ–ø–∫–∏ "–¢–∞–∫"/"–ù—ñ"
        function setupOvernightButtons() {
            const overnightButtons = document.querySelectorAll('.overnight-btn');
            const hotelBlock = document.getElementById('hotel-selection-block');
            const departureBlock = document.getElementById('departure-time-block');

            overnightButtons.forEach(button => {
                button.addEventListener('click', function () {
                    overnightButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const needsOvernight = this.dataset.overnight === 'true';
                    document.getElementById('overnight-stay').value = needsOvernight;

                    // –ü–æ–∫–∞–∑—É—î–º–æ/—Ö–æ–≤–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –±–ª–æ–∫–∏
                    hotelBlock.style.display = needsOvernight ? 'block' : 'none';
                    departureBlock.style.display = needsOvernight ? 'none' : 'block';

                    // –ó–ê–í–ê–ù–¢–ê–ñ–£–Ñ–ú–û –ì–û–°–¢–ï–õ–Ü, —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–¢–∞–∫"
                    if (needsOvernight && currentLeg.arrivalCity) {
                        loadHotelsForCity(currentLeg.arrivalCity);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –º—ñ—Å—Ç–∞
        function loadHotelsForCity(cityName) {
            const hotelSelect = document.getElementById('hotel-select');
            hotelSelect.innerHTML = '<option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</option>';

            // –¢–ò–ú–ß–ê–°–û–í–û: –∑–∞–≥–ª—É—à–∫–∞ –∑ –¥–µ–∫—ñ–ª—å–∫–æ–º–∞ —Ç–µ—Å—Ç–æ–≤–∏–º–∏ –≥–æ—Ç–µ–ª—è–º–∏
            // –ù–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ —Ç—É—Ç –±—É–¥–µ AJAX-–∑–∞–ø–∏—Ç –¥–æ –≤–∞—à–æ–≥–æ n8n/workflow
            setTimeout(() => {
                // –¶–µ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ - –∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç –¥–æ API
                const testHotels = [
                    { id: 1, name: '–ì–æ—Ç–µ–ª—å "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π"', city: cityName },
                    { id: 2, name: '–•–æ—Å—Ç–µ–ª "–ü–æ–¥–æ—Ä–æ–∂–Ω–∏–∫"', city: cityName },
                    { id: 3, name: '–ì–æ—Ç–µ–ª—å "–ü—Ä–µ—Å—Ç–∏–∂"', city: cityName }
                ];

                hotelSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å...</option>';
                testHotels.forEach(hotel => {
                    const option = new Option(hotel.name, hotel.id);
                    hotelSelect.appendChild(option);
                });
            }, 500);
        }

        function processStep6() {
            const overnightInput = document.getElementById('overnight-stay');

            if (overnightInput.value === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å, —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–æ—á—ñ–≤–ª—è.');
                return;
            }

            currentLeg.overnightStay = (overnightInput.value === 'true');

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –Ω–æ—á—ñ–≤–ª—ñ "–¢–∞–∫"
            if (currentLeg.overnightStay) {
                const hotelSelect = document.getElementById('hotel-select');
                currentLeg.hotelId = hotelSelect.value;
                currentLeg.hotelName = hotelSelect.options[hotelSelect.selectedIndex]?.text;

                if (!currentLeg.hotelId || currentLeg.hotelId === '') {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å.');
                    return;
                }
            }
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –Ω–æ—á—ñ–≤–ª—ñ "–ù—ñ"
            else {
                const nextDepartureTime = document.getElementById('next-departure-time');
                currentLeg.nextDepartureTime = nextDepartureTime.value;

                if (!currentLeg.nextDepartureTime || currentLeg.nextDepartureTime === '') {
                    alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —á–∞—Å –≤–∏—ó–∑–¥—É.');
                    return;
                }

                // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∞—Å –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ —á–∞—Å—É –ø—Ä–∏–±—É—Ç—Ç—è
                if (currentLeg.arrivalTime && currentLeg.nextDepartureTime <= currentLeg.arrivalTime) {
                    alert('–ß–∞—Å –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —á–∞—Å—É –ø—Ä–∏–±—É—Ç—Ç—è!');
                    return;
                }
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—î –∑ –º—ñ—Å—Ç–æ–º –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
            if (currentLeg.departureCity === currentLeg.arrivalCity) {
                alert('–ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏ –∑ –º—ñ—Å—Ç–æ–º –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è!');
                return;
            }

            // –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É
            const newIndex = tripData.legs.length;
            tripData.legs.push({ ...currentLeg });

            // –î–æ–¥–∞—î–º–æ —Å–µ–≥–º–µ–Ω—Ç –¥–æ –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
            addLegToSummary(currentLeg, newIndex);

            // –°–∫–∏–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            currentLeg = {};

            // –û—á–∏—â–∞—î–º–æ –∫–Ω–æ–ø–∫–∏ –Ω–æ—á—ñ–≤–ª—ñ
            document.querySelectorAll('.overnight-btn').forEach(btn => btn.classList.remove('active'));
            overnightInput.value = '';

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è –≥–æ—Ç–µ–ª—é —Ç–∞ —á–∞—Å—É –≤–∏—ó–∑–¥—É
            document.getElementById('hotel-select').innerHTML = '<option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤...</option>';
            document.getElementById('next-departure-time').selectedIndex = 0;

            // –•–æ–≤–∞—î–º–æ –±–ª–æ–∫–∏
            document.getElementById('hotel-selection-block').style.display = 'none';
            document.getElementById('departure-time-block').style.display = 'none';

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∫—Ä–æ–∫—É
            showStep(7);

            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é –¥–ª—è –∫—Ä–æ–∫—É 6 (–æ—á–∏—â–∞—î–º–æ)
            updateStepPreview(6, null);
        }

        // ===== –ö–†–û–ö 7: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è =====
        function addAnotherLeg() {
            const lastLeg = tripData.legs[tripData.legs.length - 1];
            if (lastLeg) {
                currentLeg.departureCity = lastLeg.arrivalCity;
                document.getElementById('departure-city').value = currentLeg.departureCity;

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∞—Ç—É –≤–∏—ó–∑–¥—É —Ç–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –¥–∞—Ç—É
                const departureDateInput = document.getElementById('departure-date');
                departureDateInput.value = lastLeg.arrivalDate;
                departureDateInput.min = lastLeg.arrivalDate; // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –¥–∞—Ç—É
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏—ó–∑–¥—É —è–∫ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É
                const departureTimeSelect = document.getElementById('departure-time');
                const [lastArrHours, lastArrMinutes] = lastLeg.arrivalTime.split(':').map(Number);
                const lastArrTotalMinutes = lastArrHours * 60 + lastArrMinutes;

                // –û–Ω–æ–≤–ª—é—î–º–æ –æ–ø—Ü—ñ—ó —á–∞—Å—É
                departureTimeSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';
                for (let hours = 0; hours < 24; hours++) {
                    for (let minutes = 0; minutes < 60; minutes += 30) {
                        const totalMinutes = hours * 60 + minutes;
                        if (totalMinutes > lastArrTotalMinutes || lastLeg.arrivalDate !== lastLeg.departureDate) {
                            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            const option = new Option(timeString, timeString);
                            departureTimeSelect.appendChild(option);
                        }
                    }
                }

                // –û–Ω–æ–≤–ª—é—î–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –¥–∞—Ç–∏ –ø—Ä–∏–±—É—Ç—Ç—è
                document.getElementById('arrival-date').min = lastLeg.arrivalDate;
            }
            showStep(2);
        }

        function finishTrip() {
            // –¢—É—Ç –±—É–¥–µ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –ø–æ—á–∞—Ç–∫–æ–≤–æ—é
            // —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö (tripData) —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫
            console.log('–í—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –î–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:', tripData);
            alert('–í—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –î–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12).');
            // –ù–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–µ–±—Ö—É–∫–∞
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—É –¥–æ –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
        function addLegToSummary(legData, index) {
            const summaryContainer = document.getElementById('trip-summary');
            if (summaryContainer.querySelector('p.text-muted')) {
                summaryContainer.innerHTML = '';
            }

            const legElement = document.createElement('div');
            legElement.className = 'leg-item mb-3 p-3 border rounded';
            legElement.dataset.index = index || tripData.legs.length;

            let hotelInfo = '';
            if (legData.overnightStay && legData.hotelName) {
                hotelInfo = `<br><small>–ì–æ—Ç–µ–ª—å: ${legData.hotelName}</small>`;
            } else if (!legData.overnightStay && legData.nextDepartureTime) {
                hotelInfo = `<br><small>–ß–∞—Å –≤–∏—ó–∑–¥—É: ${legData.nextDepartureTime}</small>`;
            }

            legElement.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong>${legData.departureCity}</strong> ‚Üí
                    <strong>${legData.arrivalCity}</strong>
                    <br>
                    <small>–í–∏—ó–∑–¥: ${legData.departureDate} –æ ${legData.departureTime}</small>
                    <br>
                    <small>–ü—Ä–∏–±—É—Ç—Ç—è: ${legData.arrivalDate} –æ ${legData.arrivalTime}</small>
                    <br>
                    <small>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${getTransportLabel(legData.transportType)}</small>
                    ${hotelInfo}
                </div>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-warning me-1" onclick="editLeg(${legElement.dataset.index})">‚úèÔ∏è</button>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteLeg(${legElement.dataset.index})">üóëÔ∏è</button>
                </div>
            </div>
        `;
            summaryContainer.appendChild(legElement);
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º—ñ—Ç–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
        function getTransportLabel(transportKey) {
            const transportMap = {
                'train': '–ó–∞–ª—ñ–∑–Ω–∏—Ü—è',
                'company_car': '–°–ª—É–∂–±–æ–≤–µ –∞–≤—Ç–æ',
                'bus': '–ê–≤—Ç–æ–±—É—Å',
                'personal_car': '–û—Å–æ–±–∏—Å—Ç–µ –∞–≤—Ç–æ'
            };
            return transportMap[transportKey] || transportKey;
        }

        // ===== –§–£–ù–ö–¶–Ü–á –û–ë–†–û–ë–ö–ò –ö–û–ñ–ù–û–ì–û –ö–†–û–ö–£ =====
        function processStep1() {
            // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –ø–æ–ª—è –≤–≤–æ–¥—É –º—ñ—Å—Ç–∞
            const cityInput = document.getElementById('departure-city');
            const cityName = cityInput.value.trim();

            // –ü—Ä–æ—Å—Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
            if (cityName === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ.');
                return;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
            currentLeg.departureCity = cityName;

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (–¥–ª—è –º—ñ—Å—Ç–∞ –ø—Ä–∏–±—É—Ç—Ç—è)
            cityInput.value = '';

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É
            showStep(2);
        }

        function processStep2() {
            const dateInput = document.getElementById('departure-date');
            const timeSelect = document.getElementById('departure-time');

            if (dateInput.value === '' || timeSelect.value === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ —á–∞—Å.');
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –¥–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –≤ –º–∏–Ω—É–ª–æ–º—É —Ç–∞ –Ω–µ —Ä–∞–Ω—ñ—à–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É
            const today = new Date().toISOString().split('T')[0];
            if (dateInput.value < today) {
                alert('–î–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤ –º–∏–Ω—É–ª–æ–º—É!');
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –Ω–µ —Ä–∞–Ω—ñ—à–µ –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å–µ–≥–º–µ–Ω—Ç
            if (tripData.legs.length > 0) {
                const lastLeg = tripData.legs[tripData.legs.length - 1];
                if (dateInput.value < lastLeg.arrivalDate) {
                    alert('–î–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∑–∞ –¥–∞—Ç—É –ø—Ä–∏–±—É—Ç—Ç—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É!');
                    return;
                }
            }

            currentLeg.departureDate = dateInput.value;
            currentLeg.departureTime = timeSelect.value;

            showStep(3);
        }

        function processStep3() {
            const transportInput = document.getElementById('selected-transport');

            if (transportInput.value === '') {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É.');
                return;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
            currentLeg.transportType = transportInput.value;

            // –°–∫–∏–¥–∞—î–º–æ –≤–∏–±—ñ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
            document.querySelectorAll('.transport-btn').forEach(btn => btn.classList.remove('active'));
            transportInput.value = '';

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É (–º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è)
            showStep(4);
        }

        function setupOvernightButtons() {
            const overnightButtons = document.querySelectorAll('.overnight-btn');
            const hotelBlock = document.getElementById('hotel-selection-block');
            const departureBlock = document.getElementById('departure-time-block');

            overnightButtons.forEach(button => {
                button.addEventListener('click', function () {
                    overnightButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const needsOvernight = this.dataset.overnight === 'true';
                    document.getElementById('overnight-stay').value = needsOvernight;

                    hotelBlock.style.display = needsOvernight ? 'block' : 'none';
                    departureBlock.style.display = needsOvernight ? 'none' : 'block';

                    if (needsOvernight && currentLeg.arrivalCity) {
                        loadHotelsForCity(currentLeg.arrivalCity);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–∞—Ç–∏ –ø—Ä–∏–±—É—Ç—Ç—è
        function setupDateValidation() {
            const departureDateInput = document.getElementById('departure-date');
            const arrivalDateInput = document.getElementById('arrival-date');

            departureDateInput.addEventListener('change', function () {
                if (this.value) {
                    arrivalDateInput.min = this.value;

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∞—Ç—É –ø—Ä–∏–±—É—Ç—Ç—è —Ç–∞–∫–æ—é –∂ —è–∫ –¥–∞—Ç–∞ –≤–∏—ó–∑–¥—É
                    if (!arrivalDateInput.value) {
                        arrivalDateInput.value = this.value;
                    }

                    if (arrivalDateInput.value && arrivalDateInput.value < this.value) {
                        arrivalDateInput.value = this.value;
                    }
                }
            });

            // –¢–∞–∫–æ–∂ –¥–æ–¥–∞–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É (–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤ –º–∏–Ω—É–ª–æ–º—É)
            const today = new Date().toISOString().split('T')[0];
            departureDateInput.min = today;
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É
        function updateStepPreview(stepNumber, content) {
            const previewElement = document.getElementById(`step-${stepNumber}-preview`);
            const contentElement = document.getElementById(`step-${stepNumber}-preview-content`);

            if (content) {
                contentElement.innerHTML = content;
                previewElement.style.display = 'block';
            } else {
                previewElement.style.display = 'none';
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É
        function setupPreviewUpdates() {
            // –ö—Ä–æ–∫ 1: –ú—ñ—Å—Ç–æ
            document.getElementById('departure-city').addEventListener('input', function () {
                if (this.value.trim()) {
                    updateStepPreview(1, `<strong>–ú—ñ—Å—Ç–æ:</strong> ${this.value}`);
                } else {
                    updateStepPreview(1, null);
                }
            });

            // –ö—Ä–æ–∫ 2: –î–∞—Ç–∞ —ñ —á–∞—Å
            document.getElementById('departure-date').addEventListener('change', updateStep2Preview);
            document.getElementById('departure-time').addEventListener('change', updateStep2Preview);

            function updateStep2Preview() {
                const date = document.getElementById('departure-date').value;
                const time = document.getElementById('departure-time').value;

                if (date && time) {
                    updateStepPreview(2, `<strong>–í–∏—ó–∑–¥:</strong> ${date} –æ ${time}`);
                } else {
                    updateStepPreview(2, null);
                }
            }

            // –ö—Ä–æ–∫ 3: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            document.querySelectorAll('.transport-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    updateStepPreview(3, `<strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</strong> ${this.textContent}`);
                });
            });

            // –ö—Ä–æ–∫ 4: –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è
            document.getElementById('arrival-city').addEventListener('input', function () {
                if (this.value.trim()) {
                    updateStepPreview(4, `<strong>–ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è:</strong> ${this.value}`);
                } else {
                    updateStepPreview(4, null);
                }
            });

            // –ö—Ä–æ–∫ 5: –î–∞—Ç–∞ —ñ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è
            document.getElementById('arrival-date').addEventListener('change', updateStep5Preview);
            document.getElementById('arrival-time').addEventListener('change', updateStep5Preview);

            function updateStep5Preview() {
                const date = document.getElementById('arrival-date').value;
                const time = document.getElementById('arrival-time').value;

                if (date && time) {
                    updateStepPreview(5, `<strong>–ü—Ä–∏–±—É—Ç—Ç—è:</strong> ${date} –æ ${time}`);
                } else {
                    updateStepPreview(5, null);
                }
            }

            // –ö—Ä–æ–∫ 6: –ù–æ—á—ñ–≤–ª—è
            document.querySelectorAll('.overnight-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const choice = this.dataset.overnight === 'true' ? '–¢–∞–∫' : '–ù—ñ';
                    updateStepPreview(6, `<strong>–ù–æ—á—ñ–≤–ª—è:</strong> ${choice}`);
                });
            });
        }

        function editLeg(index) {
            const legToEdit = tripData.legs[index];

            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —Ñ–æ—Ä–º—É –¥–∞–Ω–∏–º–∏ –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è
            document.getElementById('departure-city').value = legToEdit.departureCity;
            document.getElementById('departure-date').value = legToEdit.departureDate;
            document.getElementById('departure-time').value = legToEdit.departureTime;

            // –í–∏–±–∏—Ä–∞—î–º–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            document.querySelectorAll('.transport-btn').forEach(btn => {
                if (btn.dataset.transport === legToEdit.transportType) {
                    btn.click();
                }
            });

            // –í–∏–¥–∞–ª—è—î–º–æ —Ü–µ–π —Å–µ–≥–º–µ–Ω—Ç –∑ –º–∞—Å–∏–≤—É
            tripData.legs.splice(index, 1);

            // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            updateSummaryDisplay();

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –ø–µ—Ä—à–æ–≥–æ –∫—Ä–æ–∫—É
            showStep(1);
        }

        function deleteLeg(index) {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Å–µ–≥–º–µ–Ω—Ç –ø–æ—ó–∑–¥–∫–∏?')) {
                tripData.legs.splice(index, 1);
                updateSummaryDisplay();
            }
        }

        function updateSummaryDisplay() {
            const summaryContainer = document.getElementById('trip-summary');
            summaryContainer.innerHTML = '';

            if (tripData.legs.length === 0) {
                summaryContainer.innerHTML = '<p class="text-muted mb-0">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞.</p>';
            } else {
                tripData.legs.forEach((leg, index) => {
                    addLegToSummary(leg, index);
                });
            }
        }

        // ===== –ü–û–ß–ê–¢–ö–û–í–ï –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø =====
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.onload = function () {
            populateSelectWithTime('departure-time');
            populateSelectWithTime('arrival-time');
            populateSelectWithTime('next-departure-time');

            setupTransportButtons();
            setupOvernightButtons();
            setupDateValidation();
            setupPreviewUpdates(); // –î–æ–¥–∞—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é
        };
    </script>
</body>

</html>