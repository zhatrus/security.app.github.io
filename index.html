<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <meta name="description" content="–î–æ–¥–∞—Ç–æ–∫ –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Å–ª—É–∂–±–æ–≤–∏—Ö –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å">
    <title>–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Supabase JS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    <style>
        body {
            background: linear-gradient(180deg, #E3EEFF 0%, #F3F8FF 100%) fixed;
            background-image: url('background.png');
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
            min-height: 100vh;
        }
        
        /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –±–ª–æ–∫—ñ–≤ */
        .question-step {
            display: none;
        }

        .active-step {
            display: block;
        }

        /* –ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó */
        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
        }

        /* –°—Ç–∏–ª—å –¥–ª—è —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö */
        .current-data-preview {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            padding: 15px;
            margin: 15px 0;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .current-data-preview:hover {
            background: rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .current-data-preview h6 {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }
        .toast {
            min-width: 300px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        @media (max-width: 768px) {
            .toast {
                width: 90%;
                min-width: auto;
                margin: 0 auto 10px;
            }
            
            .transport-btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .overnight-btn {
                width: calc(50% - 0.5rem);
            }

            .leg-item {
                background: #fff;
                border-radius: 15px;
                margin-bottom: 1rem;
            }
        }

        /* –ó–∞–≥–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Ñ–æ—Ä–º —Ç–∞ –∫–Ω–æ–ø–æ–∫ */
        .form-control, .form-select {
            border: 1px solid rgba(0,0,0,0.1);
            background: rgba(255,255,255,0.9);
        }

        .form-control:focus, .form-select:focus {
            background: rgba(255,255,255,0.95);
            box-shadow: 0 0 0 0.25rem rgba(13,110,253,.15);
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border-radius: 50rem;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø—É */
        @media (min-width: 769px) {
            .container {
                max-width: 900px;
            }
            
            .card {
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            }
            
            .transport-btn {
                min-width: 150px;
                margin-right: 0.5rem;
            }
        }
    </style>

</head>

<body>

    <div class="container py-5">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="row justify-content-center mb-4" id="main-header">
            <div class="col-md-10 text-center">
                <div class="bg-white bg-opacity-75 p-4 rounded-4 backdrop-blur">
                    <h1 class="display-6 mb-2">–ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å</h1>
                    <p class="lead mb-0">–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–ª–∞–Ω –≤–∞—à–æ—ó –ø–æ—ó–∑–¥–∫–∏</p>
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (—Å–ø–æ—á–∞—Ç–∫—É –ø–æ—Ä–æ–∂–Ω—ñ–π) -->
        <div class="row justify-content-center mb-4">
            <div class="col-md-10">
                <div id="summary-container" class="card bg-white bg-opacity-75 backdrop-blur" style="display: none;">
                    <div class="card-header">
                        –ó–≤–µ–¥–µ–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
                    </div>
                    <div id="trip-summary" class="card-body">
                        <!-- –¢—É—Ç –¥–∏–Ω–∞–º—ñ—á–Ω–æ –±—É–¥–µ –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫–æ–∂–µ–Ω —Å–µ–≥–º–µ–Ω—Ç -->
                        <p class="text-muted mb-0">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ñ–æ—Ä–º–∏ –∑ –ø–∏—Ç–∞–Ω–Ω—è–º–∏ -->
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card shadow-sm rounded-4 border-0 bg-white bg-opacity-75 backdrop-blur">
                    <div class="card-body p-4">

                        <!-- –ü–æ—á–∞—Ç–æ–∫ —Ñ–æ—Ä–º–∏ -->
                        <form id="trip-form">

                            <!-- –ö—Ä–æ–∫ 1: –ú—ñ—Å—Ç–æ –ø–æ—á–∞—Ç–∫—É -->
                            <div id="step-1" class="question-step active-step">
                                <h5 class="card-title mb-4">1. –ú—ñ—Å—Ç–æ –ø–æ—á–∞—Ç–∫—É –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</h5>
                                <div id="step-1-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-1-preview-content"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="departure-city" class="form-label">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ:</label>
                                    <!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥—É –º—ñ—Å—Ç–∞ –∑ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è–º -->
                                    <input type="text" class="form-control form-control-lg rounded-4" id="departure-city"
                                        placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                                    <!-- –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∞–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è (–±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π —á–µ—Ä–µ–∑ JS) -->
                                    <div id="city-suggestions" class="list-group mt-2" style="display: none;"></div>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-primary" onclick="processStep1()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(2)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ö—Ä–æ–∫ 2: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –≤–∏—ó–∑–¥—É -->
                            <div id="step-2" class="question-step">
                                <h5 class="card-title mb-4">2. –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –≤–∏—ó–∑–¥—É</h5>
                                <div id="step-2-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-2-preview-content"></div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="departure-date" class="form-label">–î–∞—Ç–∞:</label>
                                        <input type="date" class="form-control" id="departure-date">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="departure-time" class="form-label">–ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å:</label>
                                        <select class="form-select" id="departure-time">
                                            <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                            <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-secondary me-2"
                                        onclick="showStep(1)">–ù–∞–∑–∞–¥</button>
                                    <button type="button" class="btn btn-primary" onclick="processStep2()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(3)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ö—Ä–æ–∫ 3: –¢–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É -->
                            <div id="step-3" class="question-step">
                                <h5 class="card-title mb-4">3. –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É</h5>
                                <div id="step-3-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-3-preview-content"></div>
                                </div>
                                <div class="d-grid gap-2 d-md-flex mb-4">
                                    <!-- –ì—Ä—É–ø–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤–∏–±–æ—Ä—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É -->
                                    <button type="button" class="btn btn-outline-primary transport-btn flex-fill"
                                        data-transport="train">–ó–∞–ª—ñ–∑–Ω–∏—Ü—è</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn flex-fill"
                                        data-transport="company_car">–°–ª—É–∂–±–æ–≤–µ –∞–≤—Ç–æ</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn flex-fill"
                                        data-transport="bus">–ê–≤—Ç–æ–±—É—Å</button>
                                    <button type="button" class="btn btn-outline-primary transport-btn flex-fill"
                                        data-transport="personal_car">–û—Å–æ–±–∏—Å—Ç–µ –∞–≤—Ç–æ</button>
                                </div>
                                <input type="hidden" id="selected-transport">
                                <div class="d-flex justify-content-center">
                                    <button type="button" class="btn btn-secondary me-2"
                                        onclick="showStep(2)">–ù–∞–∑–∞–¥</button>
                                    <button type="button" class="btn btn-primary" onclick="processStep3()">–î–∞–ª—ñ</button>
                                    <!-- <button type="button" class="btn btn-primary" onclick="showStep(4)">–î–∞–ª—ñ</button> -->
                                </div>
                            </div>

                            <!-- –ú—ñ—Å—Ü–µ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤ (4, 5, 6...) -->
                            <!-- –ö—Ä–æ–∫ 4: –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è -->
                            <div id="step-4" class="question-step">
                                <h5 class="card-title mb-4">4. –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è</h5>
                                <div id="step-4-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-4-preview-content"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="arrival-city" class="form-label">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ:</label>
                                    <input type="text" class="form-control" id="arrival-city"
                                        placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞...">
                                    <div id="arrival-city-suggestions" class="list-group mt-2" style="display: none;">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(3)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep4()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 5: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è -->
                            <div id="step-5" class="question-step">
                                <h5 class="card-title mb-4">5. –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è</h5>
                                <div id="step-5-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-5-preview-content"></div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="arrival-date" class="form-label">–î–∞—Ç–∞:</label>
                                        <input type="date" class="form-control" id="arrival-date">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="arrival-time" class="form-label">–ü—Ä–∏–±–ª–∏–∑–Ω–∏–π —á–∞—Å:</label>
                                        <select class="form-select" id="arrival-time">
                                            <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                            <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                        </select>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(4)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep5()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 6: –ù–æ—á—ñ–≤–ª—è -->
                            <div id="step-6" class="question-step">
                                <h5 class="card-title mb-4">6. –ß–∏ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∞ –Ω–æ—á—ñ–≤–ª—è?</h5>
                                <div id="step-6-preview" class="current-data-preview" style="display: none;">
                                    <h6>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥:</h6>
                                    <div id="step-6-preview-content"></div>
                                </div>
                                <div class="mb-4">
                                    <button type="button" class="btn btn-outline-primary me-2 overnight-btn"
                                        data-overnight="true">–¢–∞–∫</button>
                                    <button type="button" class="btn btn-outline-primary overnight-btn"
                                        data-overnight="false">–ù—ñ</button>
                                    <input type="hidden" id="overnight-stay">
                                </div>
                                <!-- –ë–ª–æ–∫ –¥–ª—è –≥–æ—Ç–µ–ª—é (–∑'—è–≤–∏—Ç—å—Å—è –ª–∏—à–µ —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–¢–∞–∫") -->
                                <div id="hotel-selection-block" style="display: none;" class="mb-3">
                                    <label for="hotel-select" class="form-label">–û–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å:</label>
                                    <select class="form-select" id="hotel-select">
                                        <option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤...</option>
                                    </select>
                                </div>
                                <!-- –ë–ª–æ–∫ –¥–ª—è —á–∞—Å—É –≤–∏—ó–∑–¥—É (–∑'—è–≤–∏—Ç—å—Å—è –ª–∏—à–µ —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–ù—ñ") -->
                                <div id="departure-time-block" style="display: none;" class="mb-3">
                                    <label for="next-departure-time" class="form-label">–ß–∞—Å –≤–∏—ó–∑–¥—É:</label>
                                    <select class="form-select" id="next-departure-time">
                                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>
                                        <!-- –û–ø—Ü—ñ—ó —á–∞—Å—É –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JS -->
                                    </select>
                                </div>
                                <button type="button" class="btn btn-secondary me-2"
                                    onclick="showStep(5)">–ù–∞–∑–∞–¥</button>
                                <button type="button" class="btn btn-primary" onclick="processStep6()">–î–∞–ª—ñ</button>
                            </div>

                            <!-- –ö—Ä–æ–∫ 7: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è/–î–æ–¥–∞—Ç–∏ —â–µ –º—ñ—Å—Ç–æ -->
                            <div id="step-7" class="question-step">
                                <h5 class="card-title mb-4">–°–µ–≥–º–µ–Ω—Ç –ø–æ—ó–∑–¥–∫–∏ –¥–æ–¥–∞–Ω–æ!</h5>
                                <p class="mb-4">–í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —â–µ –æ–¥–∏–Ω —Å–µ–≥–º–µ–Ω—Ç (–º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è —Å—Ç–∞–Ω–µ –º—ñ—Å—Ç–æ–º
                                    –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è) –∞–±–æ –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è.</p>
                                <button type="button" class="btn btn-outline-secondary me-2"
                                    onclick="addAnotherLeg()">–î–æ–¥–∞—Ç–∏ —â–µ –º—ñ—Å—Ç–æ</button>
                                <button type="button" class="btn btn-success" id="finish-btn"
                                    onclick="finishTrip()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</button>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç–∏" –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–º—É –∫—Ä–æ—Ü—ñ -->
                            <!-- <button type="button" id="finish-btn" class="btn btn-success">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button> -->

                        </form>
                        <!-- –ö—ñ–Ω–µ—Ü—å —Ñ–æ—Ä–º–∏ -->

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ Bootstrap JS —Ç–∞ Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ —Ñ–∞–π–ª–∏ –∑ –º—ñ—Å—Ç–∞–º–∏ —Ç–∞ –≥–æ—Ç–µ–ª—è–º–∏ -->
    <script src="cities.js"></script>
    <script src="hotels.js"></script>
    <script>
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É Toast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
        function showToast(message, type = 'danger') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.className = 'toast fade show';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            toast.innerHTML = `
                <div class="toast-header">
                    <strong class="me-auto text-${type}">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            toastContainer.appendChild(toast);

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ Toast —á–µ—Ä–µ–∑ Bootstrap
            const bsToast = new bootstrap.Toast(toast, {
                animation: true,
                autohide: true,
                delay: 5000
            });
            bsToast.show();
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–∏–π –æ–±'—î–∫—Ç –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —Ñ–æ—Ä–º–∏
        const tripData = {
            legs: [] // –ú–∞—Å–∏–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –ø–æ—ó–∑–¥–∫–∏
        };
        let currentStep = 1;
        let currentLeg = {}; // –ü–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç, —è–∫–∏–π –∑–∞–ø–æ–≤–Ω—é—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

        // ===== –§–£–ù–ö–¶–Ü–á –î–õ–Ø –†–û–ë–û–¢–ò –ó –§–û–†–ú–û–Æ =====
        function showStep(stepNumber) {
            document.querySelector(`.question-step.active-step`).classList.remove('active-step');
            document.getElementById(`step-${stepNumber}`).classList.add('active-step');
            currentStep = stepNumber;
        }

        // –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –±—É–¥—å-—è–∫–æ–≥–æ <select> –æ–ø—Ü—ñ—è–º–∏ —á–∞—Å—É
        function populateSelectWithTime(selectId) {
            const timeSelect = document.getElementById(selectId);
            if (!timeSelect) return; // –Ø–∫—â–æ —Ç–∞–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –Ω–µ–º–∞—î, –≤–∏—Ö–æ–¥–∏–º–æ
            timeSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';

            for (let hours = 0; hours < 24; hours++) {
                for (let minutes = 0; minutes < 60; minutes += 30) {
                    const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                    const option = new Option(timeString, timeString);
                    timeSelect.appendChild(option);
                }
            }
        }

        // –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É (–∫—Ä–æ–∫ 3)
        function setupTransportButtons() {
            const transportButtons = document.querySelectorAll('.transport-btn');
            transportButtons.forEach(button => {
                button.addEventListener('click', function () {
                    // –í–∏–¥–∞–ª—è—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å —É –≤—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
                    transportButtons.forEach(btn => btn.classList.remove('active'));
                    // –î–æ–¥–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –¥–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–æ—ó –∫–Ω–æ–ø–∫–∏
                    this.classList.add('active');
                    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∏–±—Ä–∞–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –ø—Ä–∏—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ
                    document.getElementById('selected-transport').value = this.dataset.transport;
                });
            });
        }

        // ===== –ö–†–û–ö 4: –ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è =====
        function processStep4() {
            const cityInput = document.getElementById('arrival-city');
            const cityName = cityInput.value.trim();

            if (cityName === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è.');
                return;
            }

            currentLeg.arrivalCity = cityName;
            cityInput.value = ''; // –û—á–∏—â–∞—î–º–æ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            showStep(5);
        }

        // ===== –ö–†–û–ö 5: –î–∞—Ç–∞ —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è =====
        function processStep5() {
            const departureDateInput = document.getElementById('departure-date');
            const arrivalDateInput = document.getElementById('arrival-date');
            const timeSelect = document.getElementById('arrival-time');

            if (arrivalDateInput.value === '' || timeSelect.value === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è.');
                return;
            }

            // –ü–ï–†–ï–í–Ü–†–ö–ê: –¥–∞—Ç–∞ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É
            if (arrivalDateInput.value < departureDateInput.value) {
                showToast('–î–∞—Ç–∞ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É!');
                return;
            }

            // –î–û–î–ê–¢–ö–û–í–ê –ü–ï–†–ï–í–Ü–†–ö–ê: —è–∫—â–æ –¥–∞—Ç–∏ –æ–¥–Ω–∞–∫–æ–≤—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∞—Å
            if (arrivalDateInput.value === departureDateInput.value) {
                const departureTime = document.getElementById('departure-time').value;
                // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ —á–∞—Å –≤ —Ö–≤–∏–ª–∏–Ω–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                const [depHours, depMinutes] = departureTime.split(':').map(Number);
                const [arrHours, arrMinutes] = timeSelect.value.split(':').map(Number);
                
                const depTotalMinutes = depHours * 60 + depMinutes;
                const arrTotalMinutes = arrHours * 60 + arrMinutes;
                
                if (arrTotalMinutes <= depTotalMinutes) {
                    showToast('–ß–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —á–∞—Å—É –≤–∏—ó–∑–¥—É!');
                    return;
                }
            }

            currentLeg.arrivalDate = arrivalDateInput.value;
            currentLeg.arrivalTime = timeSelect.value;

            // –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É
            showStep(6);
            // –¢—ñ–ª—å–∫–∏ –ø–æ—Ç—ñ–º –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é
            updateStepPreview();

            // –í –∫—ñ–Ω—Ü—ñ –æ—á–∏—â–∞—î–º–æ –ø–æ–ª—è –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            arrivalDateInput.value = '';
            timeSelect.selectedIndex = 0;
        }

        // ===== –ö–†–û–ö 6: –ù–æ—á—ñ–≤–ª—è =====
        // –°–ø–æ—á–∞—Ç–∫—É –Ω–∞–ª–∞—à—Ç—É—î–º–æ –∫–Ω–æ–ø–∫–∏ "–¢–∞–∫"/"–ù—ñ"
        function setupOvernightButtons() {
            const overnightButtons = document.querySelectorAll('.overnight-btn');
            const hotelBlock = document.getElementById('hotel-selection-block');
            const departureBlock = document.getElementById('departure-time-block');

            overnightButtons.forEach(button => {
                button.addEventListener('click', function () {
                    overnightButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const needsOvernight = this.dataset.overnight === 'true';
                    document.getElementById('overnight-stay').value = needsOvernight;

                    // –ü–æ–∫–∞–∑—É—î–º–æ/—Ö–æ–≤–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –±–ª–æ–∫–∏
                    hotelBlock.style.display = needsOvernight ? 'block' : 'none';
                    departureBlock.style.display = needsOvernight ? 'none' : 'block';

                    // –ó–ê–í–ê–ù–¢–ê–ñ–£–Ñ–ú–û –ì–û–°–¢–ï–õ–Ü, —è–∫—â–æ –æ–±—Ä–∞–Ω–æ "–¢–∞–∫"
                    if (needsOvernight && currentLeg.arrivalCity) {
                        loadHotelsForCity(currentLeg.arrivalCity);
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤ –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –º—ñ—Å—Ç–∞
        function loadHotelsForCity(cityName) {
            const hotelSelect = document.getElementById('hotel-select');
            hotelSelect.innerHTML = '<option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</option>';

            setTimeout(() => {
                const cityHotels = window.hotels.getHotelsByCity(cityName);
                
                hotelSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å...</option>';
                cityHotels.forEach((hotel, index) => {
                    const option = new Option(hotel.name, index);
                    if (hotel.status !== "–ü–æ–≥–æ–¥–∂–µ–Ω–æ") {
                        option.disabled = true;
                        option.text += ` (${hotel.status})`;
                    }
                    hotelSelect.appendChild(option);
                });
            }, 300);
        }

        function processStep6() {
            const overnightInput = document.getElementById('overnight-stay');

            if (overnightInput.value === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å, —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –Ω–æ—á—ñ–≤–ª—è.');
                return;
            }

            currentLeg.overnightStay = (overnightInput.value === 'true');

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –Ω–æ—á—ñ–≤–ª—ñ "–¢–∞–∫"
            if (currentLeg.overnightStay) {
                const hotelSelect = document.getElementById('hotel-select');
                currentLeg.hotelId = hotelSelect.value;
                currentLeg.hotelName = hotelSelect.options[hotelSelect.selectedIndex]?.text;

                if (!currentLeg.hotelId || currentLeg.hotelId === '') {
                    showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –≥–æ—Ç–µ–ª—å.');
                    return;
                }
            }
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–ª—è –Ω–æ—á—ñ–≤–ª—ñ "–ù—ñ"
            else {
                const nextDepartureTime = document.getElementById('next-departure-time');
                currentLeg.nextDepartureTime = nextDepartureTime.value;

                if (!currentLeg.nextDepartureTime || currentLeg.nextDepartureTime === '') {
                    showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —á–∞—Å –≤–∏—ó–∑–¥—É.');
                    return;
                }

                // –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∞—Å –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ —á–∞—Å—É –ø—Ä–∏–±—É—Ç—Ç—è
                if (currentLeg.arrivalTime && currentLeg.nextDepartureTime <= currentLeg.arrivalTime) {
                    showToast('–ß–∞—Å –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é–≤–∞—Ç–∏ —á–∞—Å—É –ø—Ä–∏–±—É—Ç—Ç—è!');
                    return;
                }
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏ –∑ –º—ñ—Å—Ç–æ–º –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
            if (currentLeg.departureCity === currentLeg.arrivalCity) {
                showToast('–ú—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è –Ω–µ –º–æ–∂–µ —Å–ø—ñ–≤–ø–∞–¥–∞—Ç–∏ –∑ –º—ñ—Å—Ç–æ–º –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è!');
                return;
            }

            // –î–æ–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É
            const newIndex = tripData.legs.length;
            tripData.legs.push({ ...currentLeg });

            // –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —ñ –¥–æ–¥–∞—î–º–æ —Å–µ–≥–º–µ–Ω—Ç –¥–æ –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
            document.getElementById('summary-container').style.display = 'block';
            addLegToSummary(currentLeg, newIndex);

            // –°–∫–∏–¥–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            currentLeg = {};

            // –û—á–∏—â–∞—î–º–æ –∫–Ω–æ–ø–∫–∏ –Ω–æ—á—ñ–≤–ª—ñ
            document.querySelectorAll('.overnight-btn').forEach(btn => btn.classList.remove('active'));
            overnightInput.value = '';

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª—è –≥–æ—Ç–µ–ª—é —Ç–∞ —á–∞—Å—É –≤–∏—ó–∑–¥—É
            document.getElementById('hotel-select').innerHTML = '<option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥–æ—Ç–µ–ª—ñ–≤...</option>';
            document.getElementById('next-departure-time').selectedIndex = 0;

            // –•–æ–≤–∞—î–º–æ –±–ª–æ–∫–∏
            document.getElementById('hotel-selection-block').style.display = 'none';
            document.getElementById('departure-time-block').style.display = 'none';

            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é –≤–æ—Å—Ç–∞–Ω–Ω—î –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
            updateStepPreview();
            
            // –¢—ñ–ª—å–∫–∏ –ø–æ—Ç—ñ–º –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∫—Ä–æ–∫—É
            showStep(7);
        }

        // ===== –ö–†–û–ö 7: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è =====
        function addAnotherLeg() {
            const lastLeg = tripData.legs[tripData.legs.length - 1];
            if (lastLeg) {
                currentLeg.departureCity = lastLeg.arrivalCity;
                document.getElementById('departure-city').value = currentLeg.departureCity;

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∞—Ç—É –≤–∏—ó–∑–¥—É —Ç–∞ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –¥–∞—Ç—É
                const departureDateInput = document.getElementById('departure-date');
                departureDateInput.value = lastLeg.arrivalDate;
                departureDateInput.min = lastLeg.arrivalDate; // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—É –¥–∞—Ç—É
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —á–∞—Å –≤–∏—ó–∑–¥—É —è–∫ —á–∞—Å –ø—Ä–∏–±—É—Ç—Ç—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É
                const departureTimeSelect = document.getElementById('departure-time');
                const [lastArrHours, lastArrMinutes] = lastLeg.arrivalTime.split(':').map(Number);
                const lastArrTotalMinutes = lastArrHours * 60 + lastArrMinutes;

                // –û–Ω–æ–≤–ª—é—î–º–æ –æ–ø—Ü—ñ—ó —á–∞—Å—É
                departureTimeSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';
                for (let hours = 0; hours < 24; hours++) {
                    for (let minutes = 0; minutes < 60; minutes += 30) {
                        const totalMinutes = hours * 60 + minutes;
                        if (totalMinutes > lastArrTotalMinutes || lastLeg.arrivalDate !== lastLeg.departureDate) {
                            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            const option = new Option(timeString, timeString);
                            departureTimeSelect.appendChild(option);
                        }
                    }
                }

                // –û–Ω–æ–≤–ª—é—î–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –¥–∞—Ç–∏ –ø—Ä–∏–±—É—Ç—Ç—è
                document.getElementById('arrival-date').min = lastLeg.arrivalDate;
            }
            showStep(2);
        }

        function finishTrip() {
            // –¢—É—Ç –±—É–¥–µ –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, —á–∏ –∫—ñ–Ω—Ü–µ–≤–∞ —Ç–æ—á–∫–∞ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –ø–æ—á–∞—Ç–∫–æ–≤–æ—é
            // —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–∏—Ö (tripData) —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫
            console.log('–í—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –î–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:', tripData);
            showToast('–í—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –î–∞–Ω—ñ –≥–æ—Ç–æ–≤—ñ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏.', 'success');
            // –ù–∞—Å—Ç—É–ø–Ω–∏–º –∫—Ä–æ–∫–æ–º –±—É–¥–µ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–µ–±—Ö—É–∫–∞
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Å–µ–≥–º–µ–Ω—Ç—É –¥–æ –∑–≤–µ–¥–µ–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
        function addLegToSummary(legData, index) {
            const summaryContainer = document.getElementById('trip-summary');
            if (summaryContainer.querySelector('p.text-muted')) {
                summaryContainer.innerHTML = '';
            }

            const legElement = document.createElement('div');
            legElement.className = 'leg-item mb-3 p-3 border rounded';
            legElement.dataset.index = index || tripData.legs.length;

            let hotelInfo = '';
            if (legData.overnightStay && legData.hotelName) {
                hotelInfo = `<br><small>–ì–æ—Ç–µ–ª—å: ${legData.hotelName}</small>`;
            } else if (!legData.overnightStay && legData.nextDepartureTime) {
                hotelInfo = `<br><small>–ß–∞—Å –≤–∏—ó–∑–¥—É: ${legData.nextDepartureTime}</small>`;
            }

            legElement.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <strong>${legData.departureCity}</strong> ‚Üí
                    <strong>${legData.arrivalCity}</strong>
                    <br>
                    <small>–í–∏—ó–∑–¥: ${legData.departureDate} –æ ${legData.departureTime}</small>
                    <br>
                    <small>–ü—Ä–∏–±—É—Ç—Ç—è: ${legData.arrivalDate} –æ ${legData.arrivalTime}</small>
                    <br>
                    <small>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${getTransportLabel(legData.transportType)}</small>
                    ${hotelInfo}
                </div>
                <div>
                    <button type="button" class="btn btn-sm btn-outline-warning me-1" onclick="editLeg(${legElement.dataset.index})">‚úèÔ∏è</button>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteLeg(${legElement.dataset.index})">üóëÔ∏è</button>
                </div>
            </div>
        `;
            summaryContainer.appendChild(legElement);
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º—ñ—Ç–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
        function getTransportLabel(transportKey) {
            const transportMap = {
                'train': '–ó–∞–ª—ñ–∑–Ω–∏—Ü—è',
                'company_car': '–°–ª—É–∂–±–æ–≤–µ –∞–≤—Ç–æ',
                'bus': '–ê–≤—Ç–æ–±—É—Å',
                'personal_car': '–û—Å–æ–±–∏—Å—Ç–µ –∞–≤—Ç–æ'
            };
            return transportMap[transportKey] || transportKey;
        }

        // ===== –§–£–ù–ö–¶–Ü–á –û–ë–†–û–ë–ö–ò –ö–û–ñ–ù–û–ì–û –ö–†–û–ö–£ =====
        function processStep1() {
            // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –ø–æ–ª—è –≤–≤–æ–¥—É –º—ñ—Å—Ç–∞
            const cityInput = document.getElementById('departure-city');
            const cityName = cityInput.value.trim();

            // –ü—Ä–æ—Å—Ç–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
            if (cityName === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –º—ñ—Å—Ç–æ.');
                return;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
            currentLeg.departureCity = cityName;
            
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('main-header').style.display = 'none';
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É (—Ü–µ –∑–º—ñ–Ω–∏—Ç—å currentStep)
            showStep(2);
            
            // –ü—ñ—Å–ª—è –∑–º—ñ–Ω–∏ –∫—Ä–æ–∫—É –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é
            updateStepPreview();

            // –û—á–∏—â–∞—î–º–æ –ø–æ–ª–µ –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
            cityInput.value = '';
        }

        function processStep2() {
            const dateInput = document.getElementById('departure-date');
            const timeSelect = document.getElementById('departure-time');

            if (dateInput.value === '' || timeSelect.value === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –¥–∞—Ç—É —Ç–∞ —á–∞—Å.');
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ –¥–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –≤ –º–∏–Ω—É–ª–æ–º—É —Ç–∞ –Ω–µ —Ä–∞–Ω—ñ—à–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É
            const today = new Date().toISOString().split('T')[0];
            if (dateInput.value < today) {
                showToast('–î–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤ –º–∏–Ω—É–ª–æ–º—É!');
                return;
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –Ω–µ —Ä–∞–Ω—ñ—à–µ –∑–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Å–µ–≥–º–µ–Ω—Ç
            if (tripData.legs.length > 0) {
                const lastLeg = tripData.legs[tripData.legs.length - 1];
                if (dateInput.value < lastLeg.arrivalDate) {
                    showToast('–î–∞—Ç–∞ –≤–∏—ó–∑–¥—É –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Ä–∞–Ω—ñ—à–µ –∑–∞ –¥–∞—Ç—É –ø—Ä–∏–±—É—Ç—Ç—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É!');
                    return;
                }
            }

            currentLeg.departureDate = dateInput.value;
            currentLeg.departureTime = timeSelect.value;

            showStep(3);
            updateStepPreview();
        }

        function processStep3() {
            const transportInput = document.getElementById('selected-transport');

            if (transportInput.value === '') {
                showToast('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É.');
                return;
            }

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
            currentLeg.transportType = transportInput.value;

            // –°–∫–∏–¥–∞—î–º–æ –≤–∏–±—ñ—Ä —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
            document.querySelectorAll('.transport-btn').forEach(btn => btn.classList.remove('active'));
            transportInput.value = '';

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫—Ä–æ–∫—É (–º—ñ—Å—Ç–æ –ø—Ä–∏–±—É—Ç—Ç—è)
            showStep(4);
            updateStepPreview();
        }

        function setupOvernightButtons() {
            const overnightButtons = document.querySelectorAll('.overnight-btn');
            const hotelBlock = document.getElementById('hotel-selection-block');
            const departureBlock = document.getElementById('departure-time-block');

            overnightButtons.forEach(button => {
                button.addEventListener('click', function () {
                    overnightButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    const needsOvernight = this.dataset.overnight === 'true';
                    document.getElementById('overnight-stay').value = needsOvernight;

                    hotelBlock.style.display = needsOvernight ? 'block' : 'none';
                    departureBlock.style.display = needsOvernight ? 'none' : 'block';

                    if (needsOvernight && currentLeg.arrivalCity) {
                        loadHotelsForCity(currentLeg.arrivalCity);
                    } else if (!needsOvernight) {
                        // –û–Ω–æ–≤–ª—é—î–º–æ —á–∞—Å –≤–∏—ó–∑–¥—É –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –µ—Ç–∞–ø—É
                        const nextDepartureSelect = document.getElementById('next-departure-time');
                        nextDepartureSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';
                        
                        const [arrHours, arrMinutes] = currentLeg.arrivalTime.split(':').map(Number);
                        const arrTotalMinutes = arrHours * 60 + arrMinutes;

                        for (let hours = 0; hours < 24; hours++) {
                            for (let minutes = 0; minutes < 60; minutes += 30) {
                                const totalMinutes = hours * 60 + minutes;
                                if (totalMinutes > arrTotalMinutes) {
                                    const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                                    const option = new Option(timeString, timeString);
                                    nextDepartureSelect.appendChild(option);
                                }
                            }
                        }
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–∞—Ç–∏ –ø—Ä–∏–±—É—Ç—Ç—è —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É
        function setupDateValidation() {
            const departureDateInput = document.getElementById('departure-date');
            const arrivalDateInput = document.getElementById('arrival-date');
            const arrivalTimeSelect = document.getElementById('arrival-time');
            const departureTimeSelect = document.getElementById('departure-time');

            // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —á–∞—Å—É –ø—Ä–∏–±—É—Ç—Ç—è
            function updateArrivalTimes() {
                const isSameDate = arrivalDateInput.value === departureDateInput.value;
                const departureTime = departureTimeSelect.value;
                const [depHours, depMinutes] = departureTime.split(':').map(Number);
                const depTotalMinutes = depHours * 60 + depMinutes;

                arrivalTimeSelect.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å...</option>';
                
                for (let hours = 0; hours < 24; hours++) {
                    for (let minutes = 0; minutes < 60; minutes += 30) {
                        const totalMinutes = hours * 60 + minutes;
                        
                        // –Ø–∫—â–æ –¥–∞—Ç–∞ —Ç–∞ —Å–∞–º–∞, –ø–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —á–∞—Å –ø—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
                        if (!isSameDate || totalMinutes > depTotalMinutes) {
                            const timeString = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            const option = new Option(timeString, timeString);
                            arrivalTimeSelect.appendChild(option);
                        }
                    }
                }
            }

            departureDateInput.addEventListener('change', function () {
                if (this.value) {
                    arrivalDateInput.min = this.value;

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –¥–∞—Ç—É –ø—Ä–∏–±—É—Ç—Ç—è —Ç–∞–∫–æ—é –∂ —è–∫ –¥–∞—Ç–∞ –≤–∏—ó–∑–¥—É
                    if (!arrivalDateInput.value) {
                        arrivalDateInput.value = this.value;
                    }

                    if (arrivalDateInput.value && arrivalDateInput.value < this.value) {
                        arrivalDateInput.value = this.value;
                    }
                    
                    updateArrivalTimes();
                }
            });

            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ –¥–∞—Ç–∏ –ø—Ä–∏–±—É—Ç—Ç—è
            arrivalDateInput.addEventListener('change', updateArrivalTimes);
            
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ —á–∞—Å—É –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
            departureTimeSelect.addEventListener('change', updateArrivalTimes);

            // –¢–∞–∫–æ–∂ –¥–æ–¥–∞–º–æ –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–ª—è –¥–∞—Ç–∏ –≤–∏—ó–∑–¥—É (–Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤ –º–∏–Ω—É–ª–æ–º—É)
            const today = new Date().toISOString().split('T')[0];
            departureDateInput.min = today;
        }

        // –§—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É
        function updateStepPreview() {
            const previewContainer = document.getElementById(`step-${currentStep}-preview`);
            const previewContent = document.getElementById(`step-${currentStep}-preview-content`);
            
            if (!previewContainer || !previewContent) return;

            let html = '<div class="d-flex justify-content-between"><div class="flex-grow-1">';
            
            // –î–æ–¥–∞—î–º–æ –ø–æ–ª—è –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫—Ä–æ–∫—É
            if (currentStep >= 1) {
                html += `<p class="mb-2"><strong>–ú–∞—Ä—à—Ä—É—Ç:</strong> 
                    <span id="preview-route">${currentLeg.departureCity || '___'}${currentStep > 3 ? ` ‚Üí ${currentLeg.arrivalCity || '___'}` : ''}</span>
                </p>`;
            }
            
            if (currentStep >= 2) {
                html += `<p class="mb-2"><strong>–í–∏—ó–∑–¥:</strong> 
                    <span id="preview-departure">${currentLeg.departureDate ? `${currentLeg.departureDate} –æ ${currentLeg.departureTime}` : '___'}</span>
                </p>`;
            }
            
            if (currentStep >= 3) {
                html += `<p class="mb-2"><strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</strong> 
                    <span id="preview-transport">${currentLeg.transportType ? getTransportLabel(currentLeg.transportType) : '___'}</span>
                </p>`;
            }
            
            if (currentStep >= 5) {
                html += `<p class="mb-2"><strong>–ü—Ä–∏–±—É—Ç—Ç—è:</strong> 
                    <span id="preview-arrival">${currentLeg.arrivalDate ? `${currentLeg.arrivalDate} –æ ${currentLeg.arrivalTime}` : '___'}</span>
                </p>`;
            }
            
            if (currentStep >= 6) {
                html += `<p class="mb-0"><strong>–ù–æ—á—ñ–≤–ª—è:</strong> 
                    <span id="preview-overnight">${
                        currentLeg.overnightStay !== undefined 
                            ? currentLeg.overnightStay 
                                ? `–¢–∞–∫ (${currentLeg.hotelName || '–≥–æ—Ç–µ–ª—å –Ω–µ –æ–±—Ä–∞–Ω–æ'})` 
                                : `–ù—ñ (–≤–∏—ó–∑–¥ –æ ${currentLeg.nextDepartureTime || '___'})` 
                            : '___'
                    }</span>
                </p>`;
            }

            html += `</div>
                <div class="ms-3 d-flex flex-column">
                    <small class="text-muted">–ö—Ä–æ–∫ ${currentStep} –∑ 6</small>
                </div>
            </div>`;

            previewContent.innerHTML = html;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–µ–≤—å—é —Ç—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –ø–µ—Ä—à–æ–≥–æ –º—ñ—Å—Ç–∞
            if (currentStep === 1) {
                previewContainer.style.display = 'none';
            } else {
                previewContainer.style.display = 'block';
            }
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫—Ä–æ–∫—É
        function setupPreviewUpdates() {
            // –í—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É—î–º–æ –∑–º—ñ–Ω–∏ –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤
            document.getElementById('departure-city').addEventListener('input', updateStepPreview);
            document.getElementById('departure-date').addEventListener('change', updateStepPreview);
            document.getElementById('departure-time').addEventListener('change', updateStepPreview);
            document.getElementById('arrival-city').addEventListener('input', updateStepPreview);
            document.getElementById('arrival-date').addEventListener('change', updateStepPreview);
            document.getElementById('arrival-time').addEventListener('change', updateStepPreview);
            
            // –î–ª—è –∫–Ω–æ–ø–æ–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
            document.querySelectorAll('.transport-btn').forEach(btn => {
                btn.addEventListener('click', updateStepPreview);
            });
            
            // –î–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–æ—á—ñ–≤–ª—ñ
            document.querySelectorAll('.overnight-btn').forEach(btn => {
                btn.addEventListener('click', updateStepPreview);
            });
            
            // –î–ª—è –≥–æ—Ç–µ–ª—é —Ç–∞ —á–∞—Å—É –≤–∏—ó–∑–¥—É
            document.getElementById('hotel-select').addEventListener('change', updateStepPreview);
            document.getElementById('next-departure-time').addEventListener('change', updateStepPreview);
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –ø—Ä–µ–≤—å—é
            updateStepPreview();
        }

        function editLeg(index) {
            const legToEdit = tripData.legs[index];
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ –≤ –ø–æ—Ç–æ—á–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç
            currentLeg = { ...legToEdit };
            
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –≤—Å—ñ –ø–æ–ª—è —Ñ–æ—Ä–º–∏ (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –Ω–∞ undefined)
            document.getElementById('departure-city').value = currentLeg.departureCity || '';
            document.getElementById('departure-date').value = currentLeg.departureDate || '';
            document.getElementById('departure-time').value = currentLeg.departureTime || '';
            
            // –í–∏–±–∏—Ä–∞—î–º–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
            document.querySelectorAll('.transport-btn').forEach(btn => {
                if (btn.dataset.transport === currentLeg.transportType) {
                    btn.classList.add('active');
                    document.getElementById('selected-transport').value = currentLeg.transportType;
                }
            });

            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –ø–æ–ª—è –ø—Ä–∏–±—É—Ç—Ç—è
            document.getElementById('arrival-city').value = currentLeg.arrivalCity || '';
            document.getElementById('arrival-date').value = currentLeg.arrivalDate || '';
            document.getElementById('arrival-time').value = currentLeg.arrivalTime || '';

            // –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ –Ω–æ—á—ñ–≤–ª—é
            if (currentLeg.overnightStay !== undefined) {
                document.querySelectorAll('.overnight-btn').forEach(btn => {
                    if (btn.dataset.overnight === String(currentLeg.overnightStay)) {
                        btn.click(); // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ click() –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –≤—Å—ñ—Ö –æ–±—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø–æ–¥—ñ–π
                    }
                });
                
                if (currentLeg.overnightStay) {
                    // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏–º–æ –≥–æ—Ç–µ–ª—ñ —ñ –≤–∏–±–µ—Ä–µ–º–æ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π
                    loadHotelsForCity(currentLeg.arrivalCity);
                    setTimeout(() => {
                        const hotelSelect = document.getElementById('hotel-select');
                        Array.from(hotelSelect.options).forEach((option, idx) => {
                            if (option.text === currentLeg.hotelName) {
                                hotelSelect.selectedIndex = idx;
                            }
                        });
                    }, 500);
                } else if (currentLeg.nextDepartureTime) {
                    document.getElementById('next-departure-time').value = currentLeg.nextDepartureTime;
                }
            }

            // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —Å–µ–≥–º–µ–Ω—Ç
            tripData.legs.splice(index, 1);
            updateSummaryDisplay();

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–µ—Ä—à–∏–π –∫—Ä–æ–∫
            showStep(1);
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é –∑ –Ω–æ–≤–∏–º–∏ –¥–∞–Ω–∏–º–∏
            updateStepPreview();
        }

        function deleteLeg(index) {
            if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Å–µ–≥–º–µ–Ω—Ç –ø–æ—ó–∑–¥–∫–∏?')) {
                tripData.legs.splice(index, 1);
                updateSummaryDisplay();
            }
        }

        function updateSummaryDisplay() {
            const summaryContainer = document.getElementById('trip-summary');
            summaryContainer.innerHTML = '';

            if (tripData.legs.length === 0) {
                summaryContainer.innerHTML = '<p class="text-muted mb-0">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —â–µ –Ω–µ –¥–æ–¥–∞–Ω–∞.</p>';
            } else {
                tripData.legs.forEach((leg, index) => {
                    addLegToSummary(leg, index);
                });
            }
        }

        // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch((err) => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // ===== –ü–û–ß–ê–¢–ö–û–í–ï –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø =====
        // –í–∏–∫–ª–∏–∫–∞—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.onload = function () {
            // –Ü—Å–Ω—É—é—á—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
            populateSelectWithTime('departure-time');
            populateSelectWithTime('arrival-time');
            populateSelectWithTime('next-departure-time');
            setupTransportButtons();
            setupOvernightButtons();
            setupDateValidation();
            setupPreviewUpdates();

            // –î–æ–¥–∞—î–º–æ –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–ª—è –ø–æ–ª—ñ–≤ –º—ñ—Å—Ç
            ['departure-city', 'arrival-city'].forEach(cityInputId => {
                const input = document.getElementById(cityInputId);
                const suggestionsContainer = input.nextElementSibling;

                input.addEventListener('input', function() {
                    const query = this.value.trim();
                    if (query.length < 2) {
                        suggestionsContainer.style.display = 'none';
                        return;
                    }

                    const suggestions = window.searchCities(query);
                    if (suggestions.length > 0) {
                        suggestionsContainer.innerHTML = suggestions
                            .map(city => `<button class="list-group-item list-group-item-action">${city}</button>`)
                            .join('');
                        suggestionsContainer.style.display = 'block';

                        // –û–±—Ä–æ–±–∫–∞ –∫–ª—ñ–∫—ñ–≤ –ø–æ –ø—ñ–¥–∫–∞–∑–∫–∞—Ö
                        suggestionsContainer.querySelectorAll('button').forEach(btn => {
                            btn.addEventListener('click', function() {
                                input.value = this.textContent;
                                suggestionsContainer.style.display = 'none';
                                // –û–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–µ–≤—å—é —è–∫—â–æ —î
                                input.dispatchEvent(new Event('input'));
                            });
                        });
                    } else {
                        suggestionsContainer.style.display = 'none';
                    }
                });

                // –•–æ–≤–∞—î–º–æ –ø—ñ–¥–∫–∞–∑–∫–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –ø–æ–ª–µ–º
                document.addEventListener('click', function(e) {
                    if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                        suggestionsContainer.style.display = 'none';
                    }
                });
            });
        };
    </script>

    <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ Supabase -->
    <script>
        const supabaseUrl = 'https://ssdjfcdgxlxcoidpndix.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzZGpmY2RneGx4Y29pZHBuZGl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMTE1NDYsImV4cCI6MjA3MjU4NzU0Nn0.WHruUEls1-V418FducFudKI38HiPGbuNUyFAj_W-z2o';
        const baseUrl = 'https://zhatrus.github.io/security.app.github.io';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è UI –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞–Ω—É –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
        function updateUI(session) {
            const elements = {
                auth: document.getElementById('auth-container'),
                content: document.getElementById('main-content'),
                footer: document.getElementById('main-footer')
            };

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
            if (!elements.auth || !elements.content || !elements.footer) {
                console.log('Waiting for DOM elements...');
                setTimeout(() => updateUI(session), 100);
                return;
            }

            if (!session) {
                elements.auth.style.display = 'flex';
                elements.content.style.display = 'none';
                elements.footer.style.display = 'none';
                document.body.style.overflow = 'hidden';
            } else {
                elements.auth.style.display = 'none';
                elements.content.style.display = 'block';
                elements.footer.style.display = 'block';
                document.body.style.overflow = 'auto';
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ URL –ø—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        async function handleAuthCallback() {
            const hash = window.location.hash;
            if (hash && hash.includes('access_token')) {
                try {
                    // –û—Ç—Ä–∏–º—É—î–º–æ —Å–µ—Å—ñ—é
                    const { data: { session }, error } = await supabase.auth.getSession();
                    if (error) throw error;

                    // –í–∏–¥–∞–ª—è—î–º–æ —Ö–µ—à –∑ URL
                    window.history.replaceState(null, '', window.location.pathname);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ UI
                    updateUI(session);
                    return true;
                } catch (error) {
                    console.error('Auth callback error:', error);
                }
            }
            return false;
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        async function initAuth() {
            try {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –ø—ñ—Å–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
                const isCallback = await handleAuthCallback();
                if (!isCallback) {
                    // –Ø–∫—â–æ –Ω—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ—Ç–æ—á–Ω—É —Å–µ—Å—ñ—é
                    const { data: { session }, error } = await supabase.auth.getSession();
                    if (error) throw error;
                    updateUI(session);
                }

                // –ü—ñ–¥–ø–∏—Å—É—î–º–æ—Å—å –Ω–∞ –∑–º—ñ–Ω–∏ —Å—Ç–∞–Ω—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
                supabase.auth.onAuthStateChange((event, session) => {
                    console.log('Auth state changed:', event);
                    updateUI(session);
                });

            } catch (error) {
                console.error('Auth initialization error:', error);
            }
        }

        // –§—É–Ω–∫—Ü—ñ—ó –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        async function signInWithGoogle() {
            try {
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: `${baseUrl}/index.html`,
                        queryParams: {
                            access_type: 'offline',
                            prompt: 'consent'
                        }
                    }
                });
                if (error) throw error;
            } catch (error) {
                console.error('Google auth error:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Google', 'danger');
            }
        }

        async function signInWithMicrosoft() {
            try {
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'azure',
                    options: {
                        redirectTo: `${baseUrl}/index.html`,
                        queryParams: {
                            prompt: 'login'
                        }
                    }
                });
                if (error) throw error;
            } catch (error) {
                console.error('Microsoft auth error:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Microsoft', 'danger');
            }
        }

        async function signOut() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                updateUI(null);
            } catch (error) {
                console.error('Sign out error:', error);
                showToast('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ —Å–∏—Å—Ç–µ–º–∏', 'danger');
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAuth);
        } else {
            initAuth();
        }
    </script>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
    <div id="auth-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1050;" class="d-flex align-items-center bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10 col-lg-6 text-center">
                    <div class="bg-white bg-opacity-75 p-4 rounded-4 backdrop-blur shadow">
                        <h2 class="mb-4">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è</h2>
                        <div class="d-grid gap-3">
                            <button onclick="signInWithGoogle()" class="btn btn-lg btn-primary">
                                <i class="bi bi-google me-2"></i>
                                –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
                            </button>
                            <button onclick="signInWithMicrosoft()" class="btn btn-lg btn-secondary">
                                <i class="bi bi-microsoft me-2"></i>
                                –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Microsoft
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É -->
    <div id="main-content" style="display: none;">
        <div class="container">
            <!-- –í–µ—Å—å –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç—É—Ç -->
        </div>
    </div>

    <!-- –§—É—Ç–µ—Ä –∑ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—î—é -->
    <footer id="main-footer" class="fixed-bottom bg-light py-2 border-top" style="display: none;">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#infoModal">
                        <i class="bi bi-info-circle me-1"></i>–Ü–Ω—Ñ–æ
                    </button>
                </div>
                <div class="d-flex align-items-center">
                    <small class="text-muted me-3">v0.05</small>
                    <button onclick="signOut()" class="btn btn-sm btn-danger">
                        <i class="bi bi-box-arrow-right me-1"></i>–í–∏–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é -->
    <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="infoModalLabel">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥–æ–¥–∞—Ç–æ–∫</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>–ü—Ä–æ–≥—Ä–∞–º–∞ —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∞ –¥–ª—è –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Å–ª—É–∂–±–æ–≤–∏—Ö –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤. –í–æ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î –ø—Ä–æ—Ü–µ—Å –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –≤—ñ–¥—Ä—è–¥–∂–µ–Ω—å, –¥–æ–∑–≤–æ–ª—è—é—á–∏:</p>
                    <ul>
                        <li>–ü–ª–∞–Ω—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç –ø–æ—ó–∑–¥–∫–∏</li>
                        <li>–û–±–∏—Ä–∞—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</li>
                        <li>–ë—Ä–æ–Ω—é–≤–∞—Ç–∏ –≥–æ—Ç–µ–ª—ñ –∑ –ø–æ–≥–æ–¥–∂–µ–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É</li>
                        <li>–†–æ–∑—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</li>
                    </ul>
                    <p>–ü—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ –≤—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —Ç–∞–∫—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</p>
                    <ul>
                        <li>–î–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –≤—ñ–¥—Ä—è–¥–∂–µ–Ω–Ω—è</li>
                        <li>–í–∏–±—ñ—Ä –≥–æ—Ç–µ–ª—ñ–≤ –ª–∏—à–µ –∑ –ø–æ–≥–æ–¥–∂–µ–Ω–æ–≥–æ –ø–µ—Ä–µ–ª—ñ–∫—É</li>
                        <li>–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –º–∞—Ä—à—Ä—É—Ç—É</li>
                        <li>–ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—É –≤ –¥–æ—Ä–æ–∑—ñ</li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Toast –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å -->
    <div class="toast-container"></div>
</body>

</html>